SOURCES =
SOURCES += communication/packet.cc
SOURCES += communication/serialcom.cc
SOURCES += communication/serialstub.cc
SOURCES += messages/message.cc
SOURCES += messages/altimetermessage.cc
SOURCES += messages/ejectionsettingsmessage.cc
SOURCES += messages/rocketstatemessage.cc
SOURCES += messages/parachutestatemessage.cc
SOURCES += messages/accelerationmessage.cc
SOURCES += messages/gyromessage.cc
SOURCES += messages/gpsmetamessage.cc
SOURCES += messages/gpsdatamessage.cc
SOURCES += minimal.cc

INC_DIR := inc/
SRC_DIR := src/
BIN_DIR := obj/

SRCS := $(patsubst %.cc,$(SRC_DIR)%.cc,$(SOURCES))
BINS := $(patsubst $(SRC_DIR)%.cc,$(BIN_DIR)%.o,$(SRCS))
DEPS := $(patsubst $(SRC_DIR)%.cc,$(BIN_DIR)%.d,$(SRCS))

CXX = g++
CXXFLAGS = -MMD -D _DEBUG -c -g -Wpedantic -std=c++14

all: mini

mini: $(BINS)
	@echo $@
	@$(CXX) -o $@ $^

$(BIN_DIR)%.o: $(SRC_DIR)%.cc 
	@echo $(subst src/,"",$<)
	@mkdir -p $(dir $@)
	@$(CXX) $(CXXFLAGS) -c -o $@ $< -I$(INC_DIR)

clean:
	@rm -rf $(BIN_DIR) mini

-include $(DEPS)